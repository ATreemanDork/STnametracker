<!-- Settings UI for the Name Tracker extension -->
<div class="name-tracker-settings">
    <div class="inline-drawer">
        <div class="inline-drawer-toggle inline-drawer-header">
            <b>Name Tracker</b>
            <div class="inline-drawer-icon fa-solid fa-circle-chevron-down down"></div>
        </div>
        <div class="inline-drawer-content">
            
            <!-- Main Settings -->
            <div class="name-tracker_block flex-container">
                <label for="name_tracker_enabled" class="checkbox_label">
                    <input id="name_tracker_enabled" type="checkbox" />
                    <span>Enable Name Tracking</span>
                </label>
            </div>

            <div class="name-tracker_block flex-container">
                <label for="name_tracker_auto_analyze" class="checkbox_label">
                    <input id="name_tracker_auto_analyze" type="checkbox" />
                    <span>Auto-analyze on message threshold</span>
                </label>
            </div>

            <div class="name-tracker_block">
                <label for="name_tracker_message_frequency">
                    <small>Message Frequency (analyze every X messages)</small>
                </label>
                <input id="name_tracker_message_frequency" class="text_pole" type="number" min="1" max="100" value="10" />
            </div>

            <div class="name-tracker_block name-tracker-status-block">
                <label>Status:</label>
                <div id="name_tracker_status" class="name-tracker-status">Ready</div>
            </div>

            <hr class="sysHR" />

            <!-- LLM Settings -->
            <h4>LLM Configuration</h4>

            <div class="name-tracker_block">
                <label for="name_tracker_llm_source">
                    <small>LLM Source</small>
                </label>
                <select id="name_tracker_llm_source" class="text_pole">
                    <option value="sillytavern">SillyTavern (Current Model)</option>
                    <option value="ollama">Ollama (Local)</option>
                </select>
            </div>

            <div class="name-tracker_block ollama-settings" style="display: none;">
                <label for="name_tracker_ollama_endpoint">
                    <small>Ollama Endpoint</small>
                </label>
                <input id="name_tracker_ollama_endpoint" class="text_pole" type="text" placeholder="http://localhost:11434" />
            </div>

            <div class="name-tracker_block ollama-settings" style="display: none;">
                <label for="name_tracker_ollama_model">
                    <small>Ollama Model</small>
                </label>
                <div class="flex-container flexnowrap">
                    <select id="name_tracker_ollama_model" class="text_pole flex1">
                        <option value="">Select a model...</option>
                    </select>
                    <button id="name_tracker_load_models" class="menu_button" title="Refresh model list">
                        <i class="fa-solid fa-sync"></i>
                    </button>
                </div>
            </div>

            <div class="name-tracker_block">
                <label for="name_tracker_confidence_threshold">
                    <small>Confidence Threshold for Auto-Merge (<span id="name_tracker_confidence_value">70</span>%)</small>
                </label>
                <input id="name_tracker_confidence_threshold" class="text_pole" type="range" min="0" max="100" value="70" />
            </div>

            <div class="name-tracker_block">
                <button id="name_tracker_edit_prompt" class="menu_button" title="Edit the system prompt sent to the LLM">
                    <i class="fa-solid fa-edit"></i> Edit System Prompt
                </button>
            </div>

            <hr class="sysHR" />

            <!-- Lorebook Settings -->
            <h4>Lorebook Settings</h4>

            <div class="name-tracker_block">
                <label for="name_tracker_lorebook_position">
                    <small>Injection Position</small>
                </label>
                <select id="name_tracker_lorebook_position" class="text_pole">
                    <option value="0">After Character Defs</option>
                    <option value="1">Before Character Defs</option>
                    <option value="2">Top of Prompt</option>
                    <option value="3">Bottom of Prompt</option>
                </select>
            </div>

            <div class="name-tracker_block">
                <label for="name_tracker_lorebook_depth">
                    <small>Scan Depth</small>
                </label>
                <input id="name_tracker_lorebook_depth" class="text_pole" type="number" min="0" max="100" value="1" />
            </div>

            <div class="name-tracker_block">
                <label for="name_tracker_lorebook_cooldown">
                    <small>Cooldown</small>
                </label>
                <input id="name_tracker_lorebook_cooldown" class="text_pole" type="number" min="0" max="100" value="5" />
            </div>

            <div class="name-tracker_block">
                <label for="name_tracker_lorebook_probability">
                    <small>Activation Probability (%)</small>
                </label>
                <input id="name_tracker_lorebook_probability" class="text_pole" type="number" min="0" max="100" value="100" />
            </div>

            <div class="name-tracker_block flex-container">
                <label for="name_tracker_lorebook_enabled" class="checkbox_label">
                    <input id="name_tracker_lorebook_enabled" type="checkbox" checked />
                    <span>Enable Lorebook Entries by Default</span>
                </label>
            </div>

            <hr class="sysHR" />

            <!-- Manual Analysis Controls -->
            <h4>Manual Analysis</h4>

            <div class="name-tracker_block">
                <label for="name_tracker_manual_count">
                    <small>Number of messages to analyze</small>
                </label>
                <input id="name_tracker_manual_count" class="text_pole" type="number" min="1" max="1000" value="10" />
            </div>

            <div class="name-tracker_block flex-container flexGap5">
                <button id="name_tracker_manual_analyze" class="menu_button">
                    <i class="fa-solid fa-magnifying-glass"></i> Analyze Last X Messages
                </button>
                <button id="name_tracker_scan_all" class="menu_button">
                    <i class="fa-solid fa-search-plus"></i> Scan Entire Chat
                </button>
            </div>

            <hr class="sysHR" />

            <!-- Character List -->
            <h4>Tracked Characters</h4>

            <div id="name_tracker_character_list" class="name-tracker-character-list">
                <div class="name-tracker-empty">No characters tracked yet</div>
            </div>

            <hr class="sysHR" />

            <!-- Utility Controls -->
            <h4>Utilities</h4>

            <div class="name-tracker_block flex-container flexGap5">
                <button id="name_tracker_create_character" class="menu_button">
                    <i class="fa-solid fa-user-plus"></i> Create Character
                </button>
                <button id="name_tracker_undo_merge" class="menu_button" disabled>
                    <i class="fa-solid fa-undo"></i> Undo Last Merge
                </button>
            </div>
            
            <div class="name-tracker_block flex-container flexGap5">
                <button id="name_tracker_clear_cache" class="menu_button">
                    <i class="fa-solid fa-trash"></i> Clear Cache
                </button>
                <button id="name_tracker_purge_entries" class="menu_button">
                    <i class="fa-solid fa-trash-alt"></i> Purge All Entries
                </button>
            </div>

            <div class="name-tracker_block flex-container flexGap5">
                <button id="name_tracker_debug_status" class="menu_button" title="Show debug variables and batch configuration">
                    <i class="fa-solid fa-bug"></i> Debug Status
                </button>
                <button id="name_tracker_dump_context" class="menu_button" title="Dump entire SillyTavern context to console">
                    <i class="fa-solid fa-code"></i> Dump Context
                </button>
            </div>

            <div class="name-tracker_block flex-container">
                <label for="name_tracker_debug_mode" class="checkbox_label">
                    <input id="name_tracker_debug_mode" type="checkbox" />
                    <span>Debug Mode (Console Logging)</span>
                </label>
            </div>

            <hr class="sysHR" />
        </div>
    </div>
</div>
